<!DOCTYPE html>
<html>
<head>
	<title>Focus</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</head>
<body>
	<div class="container-fluid">
		
		<nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
		  <div class="container-fluid">
		    <a class="navbar-brand" href="#" id="brand">
		      <img src="images/focus_image.jpg" alt="" width="30" height="24" class="d-inline-block align-text-top">
		      FOCUS
		    </a>
		    <form class="d-flex">
		        
		        <button id="see_order" class="btn btn-outline-success" data-bs-toggle="offcanvas" href="#offcanvasExample" role="button" type="submit">See your order</button>
		    </form>
		  </div>
		</nav>

		<div class="container" style="margin-bottom: 64px; margin-top: 64px;">
		  <div class="header text-center">
		    <h1 class="display-3">Order anything you want!</h1>
		  </div>
		</div>

		<div class="container">
			<div  class="d-flex justify-content-center">
			  <div id="principal_load" class="spinner-border" role="status">
			    <span class="visually-hidden">Loading...</span>
			  </div>
			</div>
			<div id="principal_row" class="row">
				<!-- <div class="col md-6">
					<div class="card">
						<img src="..." class="card-img-top" alt="...">
						<div class="card-body">
						   	<h5 class="card-title">Card title</h5>
						    <p class="card-text">drink description</p>
						</div>
						<div class="card-footer text-muted">
							Action here!
						</div>
					</div>	
				</div>
				<div class="col md-6">
					<div class="card">
						<img src="..." class="card-img-top" alt="...">
						<div class="card-body">
						   	<h5 class="card-title">Card title</h5>
						    <p class="card-text">drink description</p>
						</div>
						<div class="card-footer text-muted">
							Action here!
						</div>
					</div>
				</div>-->
			</div>
		</div>

		<!-- Modal -->
		<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header">
		        <h5 class="modal-title" id="staticBackdropLabel"></h5>
		        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		      </div>
		      <div class="modal-body">
			      	<div  class="d-flex justify-content-center">
					  <div id="modal_load" class="spinner-border" role="status">
					    <span class="visually-hidden">Loading...</span>
					  </div>
					</div>
		      		<div id="modal_card" class="card">
					  <img id="img_desc" src="" class="card-img-top">
					  <div class="card-body">
					    <h5 id="title_desc" class="card-title"></h5>
					    <div id="text_desc" class="card-text"></div>
					    <!-- <a href="#" class="btn btn-primary">Go somewhere</a> -->
					  </div>
					</div>
		      </div>
		      <div class="modal-footer">
		      	<label for="quantity">How many you want?</label>
				<input type="number" id="quantity" name="quantity" min="1" max="25">
		        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
		        <button id="add_card" type="button" data-bs-dismiss="modal" class="btn btn-success">Add to card</button>
		      </div>
		    </div>
		  </div>
		</div>

		<div class="toast-container fixed-bottom"> 
			<div id="confirmation_t" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
			  <div class="toast-header">
			    <strong class="me-auto">Good Job</strong>
			    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
			  </div>
			  <div class="toast-body">		    
				successfully added
			  </div>
			</div>
		</div>
		
		<div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel">
		  <div class="offcanvas-header">
		    <h5 class="offcanvas-title" id="offcanvasExampleLabel">Order</h5>
		    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
		  </div>
		  <div class="offcanvas-body">
		    <div>
		      <div class="card">
				  <ul id="order_list" class="list-group list-group-flush">
				    <!-- <li class="list-group-item">An item</li> -->
				    
				  </ul>
				</div>
		    </div>
		    
		  </div>
		</div>
	
	</div>
</body>
<script>

	var begin_data = '';
	var myToastEl = document.getElementById('confirmation_t');
	var myToast = bootstrap.Toast.getOrCreateInstance(myToastEl);
	var orderList = [];

	$( document ).ready(function() {
	    console.log( "ready!" );
	    begin_data = conectionApi('');

	    begin_data.done(function(res_data){
	    	//console.log(res_data);

	    	$.each(res_data.drinks, function(i, val){
	    		console.log(val);
	    		$('#principal_row').append(cardHtml(val));
	    		
	    	});
	    	$('#principal_load').hide();
	    });
	    
	});

	function conectionApi(json_data){
		return $.ajax({
		   type: 'POST',
		   dataType: 'json',
		   data:json_data,
		   url: 'https://www.thecocktaildb.com/api/json/v1/1/search.php?s=orange',
		   success: function(res_data){
		   	console.log(res_data);
		   }
		});
	}

	function cardHtml(obj){
		return '<div class="col-sm-12 col-md-6" style="margin-bottom:2em;">'+
					'<div class="card">'+
						'<img src="'+obj.strDrinkThumb+'" class="card-img-top img-fluid img-thumbnail" alt="Drinks image">'+
						'<div class="card-body">'+
						   	'<h5 class="card-title">'+obj.strDrink+'</h5>'+
						    '<p class="card-text text-truncate">'+obj.strInstructions+'</p>'+
						'</div>'+
						'<div class="card-footer">'+
							'<button type="button" class="btn btn-danger btn-sm" onClick="filterAlcoholic('+"'"+obj.strAlcoholic+"'"+')">'+obj.strAlcoholic+'</button>'+
							'<button type="button" class="btn btn-success btn-sm" onClick="filterCategory('+"'"+obj.strCategory+"'"+')">'+obj.strCategory+'</button>'+
							'<button type="button" class="btn btn-primary btn-sm float-end" onClick="modalDescription('+"'"+obj.idDrink+"'"+')" data-bs-toggle="modal" data-bs-target="#staticBackdrop">View</button>'+
						'</div>'+
					'</div>'+	
				'</div>';
	}

	function modalDescription(id){
		console.log(id);
		$('#modal_load').show();
		$('#modal_card').hide();
		$('#text_desc').empty();
		$('#quantity').val(1);
		conectionApi().done(function(res_data){
			var result = res_data.drinks.filter(function(val){
				console.log(val.idDrink);
				return val.idDrink == id;
			});
			console.log('------------------------------------------------------');
			console.log(result);
			result = result[0];
			$('#img_desc').attr("src",result.strDrinkThumb);
			$('#staticBackdropLabel').text(result.strDrink);
			$('#title_desc').text(result.strDrink);
			$('#text_desc').append('INGREDIENTS');
			$('#text_desc').append('<p>'+allIngredients(result)+'</p>');
			$('#text_desc').append('<br>INSTRUCTIONS');
			$('#text_desc').append('<p>'+result.strInstructions+'</p>');
			$('#modal_load').hide();
			$('#modal_card').show();
			//console.log(result.strInstructions);

		});

	}

	function addItem(){
		orderList.forEach(function(val, index){
			$('#order_list').append('<li class="list-group-item">'+val.cant+' - '+val.name+'</li>');	
		});
	}

	function allIngredients(obj){
		var str = '';
		for (var i = 1; i <= 10; i++) {
			if(obj['strIngredient'+i]) str =  str + obj['strIngredient'+i] +'. ';
		}

		return str;
	}

	function filterAlcoholic(name){
		$('#principal_load').show();
		$('#principal_row').empty();
	    conectionApi('').done(function(res_data){
	    	$.each(res_data.drinks, function(i, val){
	    		console.log(val);
	    		if(val.strAlcoholic == name) $('#principal_row').append(cardHtml(val));
	    		//$('#principal_load').hide();
	    	});
	    	$('#principal_load').hide();
	    });
		
	}

	function filterCategory(name){
		$('#principal_load').show();
		$('#principal_row').empty();
	    conectionApi('').done(function(res_data){
	    	$.each(res_data.drinks, function(i, val){
	    		console.log(val);
	    		if(val.strCategory == name) $('#principal_row').append(cardHtml(val));
	    		//$('#principal_load').hide();
	    	});
	    	$('#principal_load').hide();
	    });
		
	}

	$('#brand').click(function(){
		$('#principal_load').show();
		$('#principal_row').empty();
	    conectionApi('').done(function(res_data){
	    	$.each(res_data.drinks, function(i, val){
	    		console.log(val);
	    		 $('#principal_row').append(cardHtml(val));
	    		//$('#principal_load').hide();
	    	});
	    	$('#principal_load').hide();
	    });
	})

	$('#add_card').click(function(){
			$('.toast').toast('show');
			orderList.push({name:$('#title_desc').text(), cant: $('#quantity').val()});
			
	});

	$('#see_order').click(function(){
		$('#order_list').empty();
		addItem();
	});

</script>
</html>